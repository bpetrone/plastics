---
title: "LEfSe"
author: "Katherine Mueller"
date: "3/22/2021"
output: html_document
---

###LEfSe Analysis

##Setup
#Load Libraries
```{r}
library(readr)
library(phyloseq)
library(tibble)
library(dplyr)
library(ggplot2)
library(microbiomeMarker)
```

# Define Paths
```{r}
plastics.rds = "/sharedspace/PlasticPeople/plastics.rds"
```

# Check Phyloseq RDS
Load your phyloseq RDS and `print` it just to be sure things look sane
```{r}
plastics.ps = read_rds(plastics.rds)
print(plastics.ps)
```

```{r}
sample_variables(plastics.ps)
```

## Styrene Monomer
We noticed from the alpha diversity analysis that in the RC and AS locations, the growth conditions with styrene monomer tracked together separately from the other two growth conditions. Thus, we want to use LEfSe to see if there are differences in the taxa associated with styrene monomer.

In order to compare styrene containing versus styrene free media, I will need to create a new sample variable.
```{r}
metadata <- plastics.ps %>%
     sample_data() %>%
     as.data.frame()

conditions <- metadata$Condition
monomer <- ifelse(conditions %in% c("PSS", "S"), "has_monomer", "no_monomer")

sample_data(plastics.ps)$monomer_presence <- monomer
```

```{r}
sample_variables(plastics.ps)
```

Since we noticed this difference towards the end of the growth period, we should look specifically at the differences between groups at on weeks 7 and 12.
```{r}
endpoint.ps <- plastics.ps %>%
     subset_samples(Week %in% c(7,12))
print(endpoint.ps)
```

#Overall PSS/S versus Ctrl/PS
First, I want to see if there are any differences in taxa between media with and without styrene, regardless of the location that samples were originally taken from.
```{r}
overall.lef <- lefse(endpoint.ps,
                     class = "monomer_presence",
                     lda_cutoff = 5,
                     multicls_strat = TRUE)
```
```{r}
plot_ef_bar(overall.lef)
```

#PSS/S versus Ctrl/PS in RC and AS locations
Now, I want to compare media with and without styrene, accounting for the fact that we found the differences in alpha diversity in the samples from the RC and AS locations.
```{r}
RCAS.ps <- plastics.ps %>%
     subset_samples(Location %in% c("RC", "AS"))
print(RCAS.ps)
```